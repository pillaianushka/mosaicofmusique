<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hip-Hop Level ‚Äì Tunnels of Szletnia</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    overflow: hidden;
    background: url('background.png') no-repeat center center fixed;
    background-size: cover;
    font-family: 'Courier New', monospace;
  }

  canvas {
    display: block;
    margin: 0 auto;
    background: transparent;
  }

  #title {
    position: absolute;
    top: 20px;
    width: 100%;
    text-align: center;
    font-size: 32px;
    color: #fff;
    text-shadow: 0 0 10px #ff00ff;
  }

  #score {
    position: absolute;
    top: 70px;
    width: 100%;
    text-align: center;
    color: #fff;
    font-size: 24px;
    text-shadow: 0 0 6px #00ffff;
  }

  #restartBtn, #startBtn {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    background: none;
    border: none;
    cursor: pointer;
  }

  #restartBtn {
    display: none;
    top: 50%;
  }

  #startBtn {
    top: 45%;
  }

  #startBtn img, #restartBtn img {
    width: 150px;
    transition: transform 0.3s ease;
  }

  #startBtn img:hover, #restartBtn img:hover {
    transform: scale(1.1);
  }

  /* --- Popup when level is complete --- */
  #popup {
    display: none;
    align-items: center;
    justify-content: center;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    color: white;
    font-size: 2rem;
    font-weight: bold;
    z-index: 1000;
    flex-direction: column;
    text-align: center;
  }

  /* --- Next level arrow --- */
  #nextBtn {
    display: none;
    margin-top: 20px;
    padding: 10px 18px;
    font-size: 1.5rem;
    border: none;
    border-radius: 50%;
    background: #fff;
    cursor: pointer;
    box-shadow: 0 0 10px rgba(0,0,0,.4);
  }
</style>
</head>
<body>
<h1 id="title">üèÅ Hip-Hop Kingdom: Tunnels of Szletnia üõπ</h1>
<h2 id="score">Score: 0</h2>
<canvas id="gameCanvas" width="480" height="640"></canvas>

<button id="startBtn"><img src="play-button.png" alt="Play"></button>
<button id="restartBtn"><img src="restart-button.png" alt="Restart"></button>

<!-- Popup for level completion -->
<div id="popup">
  <span>üéµ You conquered Szletnia! üé§</span>
  <button id="nextBtn" onclick="location.href='finalhiphop.html'">&#10145;</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const restartBtn = document.getElementById("restartBtn");
const startBtn = document.getElementById("startBtn");
const scoreDisplay = document.getElementById("score");
const popup = document.getElementById("popup");
const nextBtn = document.getElementById("nextBtn");

// --- Images ---
const knightImg = new Image();
knightImg.src = "skater.jpg";
const pipeTop = new Image();
pipeTop.src = "pipe_top.png";
const pipeBottom = new Image();
pipeBottom.src = "pipe_bottom.png";
const tunnelEffect = new Audio("hiphopbeat.mp3");

// --- Game Variables ---
let knight = { x: 50, y: 150, width: 60, height: 60, gravity: 0.25, lift: -5, velocity: 0 };
let pipes = [];
let score = 0;
let frame = 0;
let gameOver = false;
let started = false;
let pipesPassed = 0;
const pipesPerRound = 20;
const pipeSpeed = 3.5;

// --- Create Pipes ---
function createPipe() {
  const gap = 150;
  const topHeight = Math.floor(Math.random() * (canvas.height - gap - 100)) + 50;
  pipes.push({ x: canvas.width, top: topHeight, bottom: topHeight + gap });
}

// --- Draw Knight ---
function drawKnight() {
  ctx.drawImage(knightImg, knight.x, knight.y, knight.width, knight.height);
}

// --- Draw Pipes ---
function drawPipes() {
  pipes.forEach(pipe => {
    ctx.drawImage(pipeTop, pipe.x, pipe.top - 320, 80, 320);
    ctx.drawImage(pipeBottom, pipe.x, pipe.bottom, 80, 320);
  });
}

// --- Update Game ---
function update() {
  if (gameOver) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.save();
  ctx.fillStyle = "rgba(0,0,0,0.25)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.restore();

  knight.velocity += knight.gravity;
  knight.y += knight.velocity;

  drawPipes();
  drawKnight();

  pipes.forEach(pipe => { pipe.x -= pipeSpeed; });
  if (pipes.length && pipes[0].x < -80) pipes.shift();

  if (frame % 100 === 0 && pipesPassed < pipesPerRound) createPipe();

  // Collision + scoring
  pipes.forEach(pipe => {
    const hitboxPadding = 58;
    const knightLeft = knight.x + hitboxPadding;
    const knightRight = knight.x + knight.width - hitboxPadding;
    const knightTop = knight.y + hitboxPadding;
    const knightBottom = knight.y + knight.height - hitboxPadding;
    const pipeLeft = pipe.x;
    const pipeRight = pipe.x + 60;

    // Collision check
    if (
      knightRight > pipeLeft &&
      knightLeft < pipeRight &&
      (knightTop < pipe.top || knightBottom > pipe.bottom)
    ) {
      endGame();
    }

    // Scoring logic
    if (!pipe.scored && pipe.x + 80 < knight.x) {
      pipe.scored = true;
      score++;
      pipesPassed++;
      scoreDisplay.textContent = "Score: " + score;
      if (pipesPassed >= pipesPerRound) completeLevel();
    }
  });

  // Boundary collision
  if (knight.y + knight.height > canvas.height || knight.y < 0) endGame();

  frame++;
  requestAnimationFrame(update);
}

// --- Controls ---
document.addEventListener("keydown", jump);
canvas.addEventListener("click", jump);
startBtn.addEventListener("click", startGame);

function jump() {
  if (!started) return;
  knight.velocity = knight.lift;
}

// --- Start Game ---
function startGame() {
  started = true;
  startBtn.style.display = "none";
  tunnelEffect.loop = true;
  tunnelEffect.play();
  update();
}

// --- End Game ---
function endGame() {
  gameOver = true;
  tunnelEffect.pause();
  ctx.font = "36px Courier New";
  ctx.fillStyle = "white";
  ctx.textAlign = "center";
  ctx.fillText("üíÄ You crashed in Szletnia!", canvas.width / 2, canvas.height / 2);
  restartBtn.style.display = "block";
}

// --- Level Complete ---
function completeLevel() {
  gameOver = true;
  tunnelEffect.pause();
  popup.style.display = "flex"; // Show popup
  nextBtn.style.display = "inline-block";
}

// --- Restart Button ---
restartBtn.addEventListener("click", () => {
  pipes = [];
  knight.y = 150;
  knight.velocity = 0;
  score = 0;
  pipesPassed = 0;
  frame = 0;
  scoreDisplay.textContent = "Score: 0";
  gameOver = false;
  started = false;
  restartBtn.style.display = "none";
  popup.style.display = "none";
  startBtn.style.display = "block";
  ctx.clearRect(0, 0, canvas.width, canvas.height);
});
</script>
</body>
</html>
